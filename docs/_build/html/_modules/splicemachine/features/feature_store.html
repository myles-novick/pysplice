
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>splicemachine.features.feature_store &#8212; Splice MLManager  documentation</title>
    
  <link href="../../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_tabs/tabs.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script src="../../../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.js"></script>
    <script src="../../../_static/sphinx_tabs/tabs.js"></script>
    <script src="../../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
      
      <h1 class="site-logo" id="site-title">Splice MLManager  documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  Contents:
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../getting-started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../splicemachine.html">
   Splicemachine package
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../splicemachine.spark.html">
     splicemachine.spark package
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../splicemachine.mlflow_support.html">
     splicemachine.mlflow_support package
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../splicemachine.features.html">
     splicemachine.features package
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../splicemachine.notebook.html">
     splicemachine.notebook module
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../splicemachine.stats.html">
     splicemachine.stats module
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <h1>Source code for splicemachine.features.feature_store</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">stderr</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span> <span class="k">as</span> <span class="n">PandasDF</span>

<span class="kn">from</span> <span class="nn">pyspark.sql.dataframe</span> <span class="kn">import</span> <span class="n">DataFrame</span> <span class="k">as</span> <span class="n">SparkDF</span>
<span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.classification</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.regression</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">StringIndexer</span><span class="p">,</span> <span class="n">VectorAssembler</span>

<span class="kn">from</span> <span class="nn">splicemachine</span> <span class="kn">import</span> <span class="n">SpliceMachineException</span>
<span class="kn">from</span> <span class="nn">splicemachine.features.utils.feature_utils</span> <span class="kn">import</span> <span class="n">sql_to_datatype</span>
<span class="kn">from</span> <span class="nn">splicemachine.features.utils.search_utils</span> <span class="kn">import</span> <span class="n">feature_search_external</span><span class="p">,</span> <span class="n">feature_search_internal</span>
<span class="kn">from</span> <span class="nn">splicemachine.notebook</span> <span class="kn">import</span> <span class="n">_in_splice_compatible_env</span>
<span class="kn">from</span> <span class="nn">splicemachine.spark</span> <span class="kn">import</span> <span class="n">PySpliceContext</span><span class="p">,</span> <span class="n">ExtPySpliceContext</span>
<span class="kn">from</span> <span class="nn">splicemachine.features</span> <span class="kn">import</span> <span class="n">Feature</span><span class="p">,</span> <span class="n">FeatureSet</span>
<span class="kn">from</span> <span class="nn">.training_set</span> <span class="kn">import</span> <span class="n">TrainingSet</span>
<span class="kn">from</span> <span class="nn">.utils.drift_utils</span> <span class="kn">import</span> <span class="n">build_feature_drift_plot</span><span class="p">,</span> <span class="n">build_model_drift_plot</span>
<span class="kn">from</span> <span class="nn">.utils.training_utils</span> <span class="kn">import</span> <span class="n">ReturnType</span><span class="p">,</span> <span class="n">_format_training_set_output</span>
<span class="kn">from</span> <span class="nn">.pipelines</span> <span class="kn">import</span> <span class="n">FeatureAggregation</span>
<span class="kn">from</span> <span class="nn">.utils.http_utils</span> <span class="kn">import</span> <span class="n">RequestType</span><span class="p">,</span> <span class="n">make_request</span><span class="p">,</span> <span class="n">_get_feature_store_url</span><span class="p">,</span> <span class="n">Endpoints</span><span class="p">,</span> <span class="n">_get_credentials</span><span class="p">,</span> <span class="n">_get_token</span>

<span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="n">SQL</span><span class="p">,</span> <span class="n">FeatureType</span>
<span class="kn">from</span> <span class="nn">.training_view</span> <span class="kn">import</span> <span class="n">TrainingView</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">requests.auth</span> <span class="kn">import</span> <span class="n">HTTPBasicAuth</span>

<div class="viewcode-block" id="FeatureStore"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore">[docs]</a><span class="k">class</span> <span class="nc">FeatureStore</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">splice_ctx</span><span class="p">:</span> <span class="n">PySpliceContext</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splice_ctx</span> <span class="o">=</span> <span class="n">splice_ctx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mlflow_ctx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_sets</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Cache of newly created feature sets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span> <span class="o">=</span> <span class="n">_get_feature_store_url</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">:</span> <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;Uh Oh! FS_URL variable was not found... you should call &#39;fs.set_feature_store_url(&lt;url&gt;)&#39; before doing anything.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__try_auto_login</span><span class="p">()</span>

<div class="viewcode-block" id="FeatureStore.register_splice_context"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.register_splice_context">[docs]</a>    <span class="k">def</span> <span class="nf">register_splice_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">splice_ctx</span><span class="p">:</span> <span class="n">PySpliceContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">splice_ctx</span><span class="p">,</span> <span class="n">PySpliceContext</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">splice_ctx</span><span class="p">,</span> <span class="n">ExtPySpliceContext</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">SpliceMachineException</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Splice Context must be of type PySpliceContext or ExtPySpliceContext but is&#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">splice_ctx</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splice_ctx</span> <span class="o">=</span> <span class="n">splice_ctx</span></div>

<div class="viewcode-block" id="FeatureStore.get_feature_sets"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.get_feature_sets">[docs]</a>    <span class="k">def</span> <span class="nf">get_feature_sets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_set_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">FeatureSet</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of available feature sets</span>
<span class="sd">        </span>
<span class="sd">        :param feature_set_names: A list of feature set names in the format &#39;{schema_name}.{table_name}&#39;. If none will return all FeatureSets</span>
<span class="sd">        :return: List[FeatureSet] the list of Feature Sets</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">FEATURE_SETS</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span>
                         <span class="p">{</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">feature_set_names</span> <span class="p">}</span> <span class="k">if</span> <span class="n">feature_set_names</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">FeatureSet</span><span class="p">(</span><span class="o">**</span><span class="n">fs</span><span class="p">)</span> <span class="k">for</span> <span class="n">fs</span> <span class="ow">in</span> <span class="n">r</span><span class="p">]</span></div>

<div class="viewcode-block" id="FeatureStore.remove_training_view"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.remove_training_view">[docs]</a>    <span class="k">def</span> <span class="nf">remove_training_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This removes a training view if it is not being used by any currently deployed models.</span>
<span class="sd">        NOTE: Once this training view is removed, you will not be able to deploy any models that were trained using this</span>
<span class="sd">        view</span>

<span class="sd">        :param name: The view name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing Training View </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">TRAINING_VIEWS</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">DELETE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> <span class="p">{</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span> <span class="p">})</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureStore.get_summary"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.get_summary">[docs]</a>    <span class="k">def</span> <span class="nf">get_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function returns a summary of the feature store including:\n</span>
<span class="sd">        * Number of feature sets</span>
<span class="sd">        * Number of deployed feature sets</span>
<span class="sd">        * Number of features</span>
<span class="sd">        * Number of deployed features</span>
<span class="sd">        * Number of training sets</span>
<span class="sd">        * Number of training views</span>
<span class="sd">        * Number of associated models - this is a count of the MLManager.RUNS table where the `splice.model_name` tag is set and the `splice.feature_store.training_set` parameter is set</span>
<span class="sd">        * Number of active (deployed) models (that have used the feature store for training)</span>
<span class="sd">        * Number of pending feature sets - this will will require a new table `featurestore.pending_feature_set_deployments` and it will be a count of that</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">SUMMARY</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span></div>

<div class="viewcode-block" id="FeatureStore.get_training_view"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.get_training_view">[docs]</a>    <span class="k">def</span> <span class="nf">get_training_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">training_view</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TrainingView</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets a training view by name</span>

<span class="sd">        :param training_view: Training view name</span>
<span class="sd">        :return: TrainingView</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">TRAINING_VIEWS</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> <span class="p">{</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">training_view</span> <span class="p">})</span>
        <span class="k">return</span> <span class="n">TrainingView</span><span class="p">(</span><span class="o">**</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="FeatureStore.get_training_views"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.get_training_views">[docs]</a>    <span class="k">def</span> <span class="nf">get_training_views</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filter</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TrainingView</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of all available training views with an optional filter</span>

<span class="sd">        :param _filter: Dictionary container the filter keyword (label, description etc) and the value to filter on</span>
<span class="sd">            If None, will return all TrainingViews</span>
<span class="sd">        :return: List[TrainingView]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">TRAINING_VIEWS</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">TrainingView</span><span class="p">(</span><span class="o">**</span><span class="n">tv</span><span class="p">)</span> <span class="k">for</span> <span class="n">tv</span> <span class="ow">in</span> <span class="n">r</span><span class="p">]</span></div>

<div class="viewcode-block" id="FeatureStore.get_training_view_id"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.get_training_view_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_training_view_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the unique view ID from a name</span>

<span class="sd">        :param name: The training view name</span>
<span class="sd">        :return: The training view id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># return self.splice_ctx.df(SQL.get_training_view_id.format(name=name)).collect()[0][0]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">TRAINING_VIEW_ID</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> <span class="p">{</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span> <span class="p">})</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureStore.get_features_by_name"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.get_features_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_features_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">as_list</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Feature</span><span class="p">],</span> <span class="n">PandasDF</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dataframe or list of features whose names are provided</span>

<span class="sd">        :param names: The list of feature names</span>
<span class="sd">        :param as_list: Whether or not to return a list of features. Default False</span>
<span class="sd">        :return: SparkDF or List[Feature] The list of Feature objects or Spark Dataframe of features and their metadata. Note, this is not the Feature</span>
<span class="sd">        values, simply the describing metadata about the features. To create a training dataset with Feature values, see</span>
<span class="sd">        :py:meth:`features.FeatureStore.get_training_set` or :py:meth:`features.FeatureStore.get_feature_dataset`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">FEATURES</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> <span class="p">{</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">names</span> <span class="p">})</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="o">**</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">r</span><span class="p">]</span> <span class="k">if</span> <span class="n">as_list</span> <span class="k">else</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureStore.training_view_exists"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.training_view_exists">[docs]</a>    <span class="k">def</span> <span class="nf">training_view_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns if a training view exists or not</span>

<span class="sd">        :param name: The training view name</span>
<span class="sd">        :return: bool True if the training view exists, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">TRAINING_VIEW_EXISTS</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span> <span class="p">})</span>
        <span class="k">return</span> <span class="n">r</span></div>

<div class="viewcode-block" id="FeatureStore.feature_exists"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.feature_exists">[docs]</a>    <span class="k">def</span> <span class="nf">feature_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns if a feature exists or not</span>

<span class="sd">        :param name: The feature name</span>
<span class="sd">        :return: bool True if the feature exists, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">FEATURE_EXISTS</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span> <span class="p">})</span>
        <span class="k">return</span> <span class="n">r</span></div>

<div class="viewcode-block" id="FeatureStore.feature_set_exists"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.feature_set_exists">[docs]</a>    <span class="k">def</span> <span class="nf">feature_set_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns if a feature set exists or not</span>

<span class="sd">        :param schema: The feature set schema</span>
<span class="sd">        :param table: The feature set table</span>
<span class="sd">        :return: bool True if the feature exists, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">FEATURE_SET_EXISTS</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span>
                         <span class="n">params</span><span class="o">=</span><span class="p">{</span> <span class="s2">&quot;schema&quot;</span><span class="p">:</span> <span class="n">schema</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">table</span> <span class="p">})</span>
        <span class="k">return</span> <span class="n">r</span></div>

<div class="viewcode-block" id="FeatureStore.get_feature_details"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.get_feature_details">[docs]</a>    <span class="k">def</span> <span class="nf">get_feature_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Feature</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a Feature and it&#39;s detailed information</span>

<span class="sd">        :param name: The feature name</span>
<span class="sd">        :return: Feature</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">FEATURE_DETAILS</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> <span class="p">{</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span> <span class="p">})</span>
        <span class="k">return</span> <span class="n">Feature</span><span class="p">(</span><span class="o">**</span><span class="n">r</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureStore.get_feature_vector"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.get_feature_vector">[docs]</a>    <span class="k">def</span> <span class="nf">get_feature_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Feature</span><span class="p">]],</span>
                           <span class="n">join_key_values</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">return_primary_keys</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">return_sql</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">PandasDF</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets a feature vector given a list of Features and primary key values for their corresponding Feature Sets</span>

<span class="sd">        :param features: List of str Feature names or Features</span>
<span class="sd">        :param join_key_values: (dict) join key values to get the proper Feature values formatted as {join_key_column_name: join_key_value}</span>
<span class="sd">        :param return_primary_keys: Whether to return the Feature Set primary keys in the vector. Default True</span>
<span class="sd">        :param return_sql: Whether to return the SQL needed to get the vector or the values themselves. Default False</span>
<span class="sd">        :return: Pandas Dataframe or str (SQL statement)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">f</span><span class="o">.</span><span class="vm">__dict__</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">FEATURE_VECTOR</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> 
            <span class="n">params</span><span class="o">=</span><span class="p">{</span> <span class="s2">&quot;pks&quot;</span><span class="p">:</span> <span class="n">return_primary_keys</span><span class="p">,</span> <span class="s2">&quot;sql&quot;</span><span class="p">:</span> <span class="n">return_sql</span> <span class="p">},</span> 
            <span class="n">body</span><span class="o">=</span><span class="p">{</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="n">features</span><span class="p">,</span> <span class="s2">&quot;join_key_values&quot;</span><span class="p">:</span> <span class="n">join_key_values</span> <span class="p">})</span>
        <span class="k">return</span> <span class="n">r</span> <span class="k">if</span> <span class="n">return_sql</span> <span class="k">else</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="FeatureStore.get_feature_vector_sql_from_training_view"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.get_feature_vector_sql_from_training_view">[docs]</a>    <span class="k">def</span> <span class="nf">get_feature_vector_sql_from_training_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">training_view</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="n">Feature</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the parameterized feature retrieval SQL used for online model serving.</span>

<span class="sd">        :param training_view: (str) The name of the registered training view</span>
<span class="sd">        :param features: (List[str]) the list of features from the feature store to be included in the training</span>

<span class="sd">            :NOTE:</span>
<span class="sd">                .. code-block:: text</span>

<span class="sd">                    This function will error if the view SQL is missing a view key required \n</span>
<span class="sd">                    to retrieve the desired features</span>

<span class="sd">        :return: (str) the parameterized feature vector SQL</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">f</span><span class="o">.</span><span class="vm">__dict__</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">FEATURE_VECTOR_SQL</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> 
            <span class="p">{</span> <span class="s2">&quot;view&quot;</span><span class="p">:</span> <span class="n">training_view</span> <span class="p">},</span> <span class="n">features</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span></div>

<div class="viewcode-block" id="FeatureStore.get_feature_primary_keys"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.get_feature_primary_keys">[docs]</a>    <span class="k">def</span> <span class="nf">get_feature_primary_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dictionary mapping each individual feature to its primary key(s). This function is not yet implemented.</span>

<span class="sd">        :param features: (List[str]) The list of features to get primary keys for</span>
<span class="sd">        :return: Dict[str, List[str]] A mapping of {feature name: [pk1, pk2, etc]}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="FeatureStore.get_training_view_features"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.get_training_view_features">[docs]</a>    <span class="k">def</span> <span class="nf">get_training_view_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">training_view</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Feature</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the available features for the given a training view name</span>

<span class="sd">        :param training_view: The name of the training view</span>
<span class="sd">        :return: A list of available Feature objects</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">TRAINING_VIEW_FEATURES</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> <span class="p">{</span> <span class="s2">&quot;view&quot;</span><span class="p">:</span> <span class="n">training_view</span> <span class="p">})</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="o">**</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">r</span><span class="p">]</span></div>

<div class="viewcode-block" id="FeatureStore.get_feature_description"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.get_feature_description">[docs]</a>    <span class="k">def</span> <span class="nf">get_feature_description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TODO</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="FeatureStore.get_training_set"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.get_training_set">[docs]</a>    <span class="k">def</span> <span class="nf">get_training_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Feature</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">current_values_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="n">start_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">end_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">return_pk_cols</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                         <span class="n">return_ts_col</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">return_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;spark&#39;</span><span class="p">,</span>
                         <span class="n">return_sql</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">save_as</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SparkDF</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets a set of feature values across feature sets that is not time dependent (ie for non time series clustering).</span>
<span class="sd">        This feature dataset will be treated and tracked implicitly the same way a training_dataset is tracked from</span>
<span class="sd">        :py:meth:`features.FeatureStore.get_training_set` . The dataset&#39;s metadata and features used will be tracked in mlflow automatically (see</span>
<span class="sd">        get_training_set for more details).</span>

<span class="sd">        :NOTE:</span>
<span class="sd">            .. code-block:: text</span>

<span class="sd">                The way point-in-time correctness is guaranteed here is by choosing one of the Feature Sets as the &quot;anchor&quot; dataset.</span>
<span class="sd">                This means that the points in time that the query is based off of will be the points in time in which the anchor</span>
<span class="sd">                Feature Set recorded changes. The anchor Feature Set is the Feature Set that contains the superset of all primary key</span>
<span class="sd">                columns across all Feature Sets from all Features provided. If more than 1 Feature Set has the superset of</span>
<span class="sd">                all Feature Sets, the Feature Set with the most primary keys is selected. If more than 1 Feature Set has the same</span>
<span class="sd">                maximum number of primary keys, the Feature Set is chosen by alphabetical order (schema_name, table_name).</span>

<span class="sd">        :param features: List of Features or strings of feature names</span>

<span class="sd">            :NOTE:</span>
<span class="sd">                .. code-block:: text</span>

<span class="sd">                    The Features Sets which the list of Features come from must have common join keys,</span>
<span class="sd">                    otherwise the function will fail. If there is no common join key, it is recommended to</span>
<span class="sd">                    create a Training View to specify the join conditions.</span>

<span class="sd">        :param current_values_only: If you only want the most recent values of the features, set this to true. Otherwise, all history will be returned. Default False</span>
<span class="sd">        :param start_time: How far back in history you want Feature values. If not specified (and current_values_only is False), all history will be returned.</span>
<span class="sd">            This parameter only takes effect if current_values_only is False.</span>
<span class="sd">        :param end_time: The most recent values for each selected Feature. This will be the cutoff time, such that any Feature values that</span>
<span class="sd">            were updated after this point in time won&#39;t be selected. If not specified (and current_values_only is False),</span>
<span class="sd">            Feature values up to the moment in time you call the function (now) will be retrieved. This parameter</span>
<span class="sd">            only takes effect if current_values_only is False.</span>
<span class="sd">        :param label: An optional label to specify for the training set. If specified, the feature set of that feature</span>
<span class="sd">            will be used as the &quot;anchor&quot; feature set, meaning all point in time joins will be made to the timestamps of</span>
<span class="sd">            that feature set. This feature will also be recorded as a &quot;label&quot; feature for this particular training set</span>
<span class="sd">            (but not others in the future, unless this label is again specified).</span>
<span class="sd">        :param return_pk_cols: bool Whether or not the returned sql should include the primary key column(s)</span>
<span class="sd">        :param return_ts_cols: bool Whether or not the returned sql should include the timestamp column</span>
<span class="sd">        :param return_type: How the data should be returned. If not specified, a Spark DF will be returned.</span>
<span class="sd">            Available arguments are: &#39;spark&#39;, &#39;pandas&#39;, &#39;json&#39;, &#39;sql&#39;</span>
<span class="sd">            sql will return the SQL necessary to generate the dataframe</span>
<span class="sd">        :param save_as: Whether or not to save this Training Set (metadata) in the feature store for reproducibility. This</span>
<span class="sd">            enables you to version and persist the metadata for a training set of a specific model development. If you are</span>
<span class="sd">            using the Splice Machine managed MLFlow Service, this will be fully automated and managed for you upon model deployment,</span>
<span class="sd">            however you can still use this parameter to customize the name of the training set (it will default to the run id).</span>
<span class="sd">            If you are NOT using Splice Machine&#39;s mlflow service, this is a useful way to link specific modeling experiments</span>
<span class="sd">            to the exact training sets used. This DOES NOT persist the training set itself, rather the metadata required</span>
<span class="sd">            to reproduce the identical training set.</span>
<span class="sd">        :return: Spark DF or SQL statement necessary to generate the Training Set</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># ~ Backwards Compatability ~</span>
        <span class="k">if</span> <span class="n">return_sql</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Deprecated Parameter &#39;return_sql&#39;. Use return_type=&#39;sql&#39; &quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">stderr</span><span class="p">)</span>
            <span class="n">return_type</span> <span class="o">=</span> <span class="s1">&#39;sql&#39;</span>

        <span class="k">if</span> <span class="n">return_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ReturnType</span><span class="o">.</span><span class="n">get_valid</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">SpliceMachineException</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Return type must be one of </span><span class="si">{</span><span class="n">ReturnType</span><span class="o">.</span><span class="n">get_valid</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">f</span><span class="o">.</span><span class="vm">__dict__</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">TRAINING_SETS</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> 
                        <span class="n">params</span><span class="o">=</span><span class="p">{</span> <span class="s2">&quot;current&quot;</span><span class="p">:</span> <span class="n">current_values_only</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">label</span><span class="p">,</span> <span class="s2">&quot;pks&quot;</span><span class="p">:</span> <span class="n">return_pk_cols</span><span class="p">,</span> <span class="s2">&quot;ts&quot;</span><span class="p">:</span> <span class="n">return_ts_col</span><span class="p">,</span>
                          <span class="s1">&#39;save_as&#39;</span><span class="p">:</span><span class="n">save_as</span><span class="p">,</span> <span class="s1">&#39;return_type&#39;</span><span class="p">:</span> <span class="n">ReturnType</span><span class="o">.</span><span class="n">map_to_request</span><span class="p">(</span><span class="n">return_type</span><span class="p">)},</span>
                        <span class="n">body</span><span class="o">=</span><span class="p">{</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="n">features</span><span class="p">,</span> <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="n">start_time</span><span class="p">,</span> <span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="n">end_time</span><span class="p">})</span>
        <span class="n">create_time</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">][</span><span class="s1">&#39;training_set_create_ts&#39;</span><span class="p">]</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">][</span><span class="s1">&#39;training_set_start_ts&#39;</span><span class="p">]</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">][</span><span class="s1">&#39;training_set_end_ts&#39;</span><span class="p">]</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;sql&#39;</span><span class="p">]</span>
        <span class="n">tvw</span> <span class="o">=</span> <span class="n">TrainingView</span><span class="p">(</span><span class="o">**</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;training_view&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;training_view&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="o">**</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">]]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlflow_ctx</span> <span class="ow">and</span> <span class="n">return_type</span> <span class="o">!=</span> <span class="s1">&#39;sql&#39;</span><span class="p">:</span>
            <span class="c1"># These will only exist if the user called &quot;save_as&quot; otherwise they will be None</span>
            <span class="n">training_set_id</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;training_set_id&#39;</span><span class="p">)</span>
            <span class="n">training_set_version</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;training_set_version&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">link_training_set_to_mlflow</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">create_time</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">tvw</span><span class="p">,</span>
                                             <span class="n">training_set_id</span><span class="o">=</span><span class="n">training_set_id</span><span class="p">,</span>
                                             <span class="n">training_set_version</span><span class="o">=</span><span class="n">training_set_version</span><span class="p">,</span><span class="n">training_set_name</span><span class="o">=</span><span class="n">save_as</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">_format_training_set_output</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="n">return_type</span><span class="p">,</span> <span class="n">splice_ctx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">splice_ctx</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureStore.get_training_set_by_name"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.get_training_set_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_training_set_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">return_pk_cols</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                 <span class="n">return_ts_col</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">return_sql</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">return_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;spark&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a Spark DF (or SQL) of an EXISTING Training Set (one that was saved with the save_as parameter in</span>
<span class="sd">        :py:meth:`~fs.get_training_set` or :py:meth:`~fs.get_training_set_from_view`. This is useful if you&#39;ve deployed</span>
<span class="sd">        a model with a Training Set and</span>

<span class="sd">        :param name: Training Set name</span>
<span class="sd">        :param version: The version of this training set. If not set, it will grab the newest version</span>
<span class="sd">        :param return_pk_cols: bool Whether or not the returned sql should include the primary key column(s)</span>
<span class="sd">        :param return_ts_cols: bool Whether or not the returned sql should include the timestamp column</span>
<span class="sd">        :param return_sql: [DEPRECATED] (Optional[bool]) Return the SQL statement (str) instead of the Spark DF. Defaults False</span>
<span class="sd">        :param return_type: How the data should be returned. If not specified, a Spark DF will be returned.</span>
<span class="sd">            Available arguments are: &#39;spark&#39;, &#39;pandas&#39;, &#39;json&#39;, &#39;sql&#39;</span>
<span class="sd">            sql will return the SQL necessary to generate the dataframe</span>
<span class="sd">        :return: Spark DF or SQL</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># ~ Backwards Compatability ~</span>
        <span class="k">if</span> <span class="n">return_sql</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Deprecated Parameter &#39;return_sql&#39;. Use return_type=&#39;sql&#39; &quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">stderr</span><span class="p">)</span>
            <span class="n">return_type</span> <span class="o">=</span> <span class="s1">&#39;sql&#39;</span>

        <span class="k">if</span> <span class="n">return_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ReturnType</span><span class="o">.</span><span class="n">get_valid</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">SpliceMachineException</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Return type must be one of </span><span class="si">{</span><span class="n">ReturnType</span><span class="o">.</span><span class="n">get_valid</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">TRAINING_SET_BY_NAME</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span>
                        <span class="n">params</span><span class="o">=</span><span class="p">{</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">version</span><span class="p">,</span> <span class="s2">&quot;pks&quot;</span><span class="p">:</span> <span class="n">return_pk_cols</span><span class="p">,</span> <span class="s2">&quot;ts&quot;</span><span class="p">:</span> <span class="n">return_ts_col</span><span class="p">,</span>
                                 <span class="s1">&#39;return_type&#39;</span><span class="p">:</span> <span class="n">ReturnType</span><span class="o">.</span><span class="n">map_to_request</span><span class="p">(</span><span class="n">return_type</span><span class="p">)})</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;sql&quot;</span><span class="p">]</span>
        <span class="n">tvw</span> <span class="o">=</span> <span class="n">TrainingView</span><span class="p">(</span><span class="o">**</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;training_view&quot;</span><span class="p">])</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="o">**</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]]</span>
        <span class="n">create_time</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">][</span><span class="s1">&#39;training_set_create_ts&#39;</span><span class="p">]</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">][</span><span class="s1">&#39;training_set_start_ts&#39;</span><span class="p">]</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">][</span><span class="s1">&#39;training_set_end_ts&#39;</span><span class="p">]</span>
         <span class="c1"># Link this to mlflow for reproducibility and model deployment</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlflow_ctx</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">return_sql</span><span class="p">:</span>
            <span class="c1"># These will only exist if the user called &quot;save_as&quot; otherwise they will be None</span>
            <span class="n">training_set_id</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;training_set_id&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">link_training_set_to_mlflow</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">create_time</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">tvw</span><span class="p">,</span>
                                             <span class="n">training_set_id</span><span class="o">=</span><span class="n">training_set_id</span><span class="p">,</span>
                                             <span class="n">training_set_version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span> <span class="n">training_set_name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_format_training_set_output</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="n">return_type</span><span class="p">,</span> <span class="n">splice_ctx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">splice_ctx</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureStore.get_training_set_from_view"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.get_training_set_from_view">[docs]</a>    <span class="k">def</span> <span class="nf">get_training_set_from_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">training_view</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Feature</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                   <span class="n">start_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">end_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                   <span class="n">return_pk_cols</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">return_ts_col</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">return_sql</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                   <span class="n">return_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;spark&#39;</span><span class="p">,</span> <span class="n">save_as</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SparkDF</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the training set as a Spark Dataframe from a Training View. When a user calls this function (assuming they have registered</span>
<span class="sd">        the feature store with mlflow using :py:meth:`~mlflow.register_feature_store` )</span>
<span class="sd">        the training dataset&#39;s metadata will be tracked in mlflow automatically.\n</span>
<span class="sd">        The following will be tracked:\n</span>
<span class="sd">        * Training View</span>
<span class="sd">        * Selected features</span>
<span class="sd">        * Start time</span>
<span class="sd">        * End time</span>

<span class="sd">        This tracking will occur in the current run (if there is an active run)</span>
<span class="sd">        or in the next run that is started after calling this function (if no run is currently active).</span>

<span class="sd">        :param training_view: (str) The name of the registered training view</span>
<span class="sd">        :param features: (List[str] OR List[Feature]) the list of features from the feature store to be included in the training.</span>
<span class="sd">            If a list of strings is passed in it will be converted to a list of Feature. If not provided will return all available features.</span>

<span class="sd">            :NOTE:</span>
<span class="sd">                .. code-block:: text</span>

<span class="sd">                    This function will error if the view SQL is missing a join key required to retrieve the</span>
<span class="sd">                    desired features</span>

<span class="sd">        :param start_time: (Optional[datetime]) The start time of the query (how far back in the data to start). Default None</span>

<span class="sd">            :NOTE:</span>
<span class="sd">                .. code-block:: text</span>

<span class="sd">                    If start_time is None, query will start from beginning of history</span>

<span class="sd">        :param end_time: (Optional[datetime]) The end time of the query (how far recent in the data to get). Default None</span>

<span class="sd">            :NOTE:</span>
<span class="sd">                .. code-block:: text</span>

<span class="sd">                    If end_time is None, query will get most recently available data</span>

<span class="sd">        :param return_pk_cols: bool Whether or not the returned sql should include the primary key column(s)</span>
<span class="sd">        :param return_ts_cols: bool Whether or not the returned sql should include the timestamp column</span>
<span class="sd">        :param return_sql: [DEPRECATED] (Optional[bool]) Return the SQL statement (str) instead of the Spark DF. Defaults False</span>
<span class="sd">        :param return_type: How the data should be returned. If not specified, a Spark DF will be returned.</span>
<span class="sd">            Available arguments are: &#39;spark&#39;, &#39;pandas&#39;, &#39;json&#39;, &#39;sql&#39;</span>
<span class="sd">            sql will return the SQL necessary to generate the dataframe</span>
<span class="sd">        :param save_as: Whether or not to save this Training Set (metadata) in the feature store for reproducibility. This</span>
<span class="sd">            enables you to version and persist the metadata for a training set of a specific model development. If you are</span>
<span class="sd">            using the Splice Machine managed MLFlow Service, this will be fully automated and managed for you upon model deployment,</span>
<span class="sd">            however you can still use this parameter to customize the name of the training set (it will default to the run id).</span>
<span class="sd">            If you are NOT using Splice Machine&#39;s mlflow service, this is a useful way to link specific modeling experiments</span>
<span class="sd">            to the exact training sets used. This DOES NOT persist the training set itself, rather the metadata required</span>
<span class="sd">            to reproduce the identical training set.</span>
<span class="sd">        :return: Optional[SparkDF, str] The Spark dataframe of the training set or the SQL that is used to generate it (for debugging)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># ~ Backwards Compatability ~</span>
        <span class="k">if</span> <span class="n">return_sql</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Deprecated Parameter &#39;return_sql&#39;. Use return_type=&#39;sql&#39; &quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">stderr</span><span class="p">)</span>
            <span class="n">return_type</span> <span class="o">=</span> <span class="s1">&#39;sql&#39;</span>

        <span class="k">if</span> <span class="n">return_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ReturnType</span><span class="o">.</span><span class="n">get_valid</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">SpliceMachineException</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Return type must be one of </span><span class="si">{</span><span class="n">ReturnType</span><span class="o">.</span><span class="n">get_valid</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Generate the SQL needed to create the dataset</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">f</span><span class="o">.</span><span class="vm">__dict__</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span><span class="p">]</span> <span class="k">if</span> <span class="n">features</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">TRAINING_SET_FROM_VIEW</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span>
                         <span class="n">params</span><span class="o">=</span><span class="p">{</span> <span class="s2">&quot;view&quot;</span><span class="p">:</span> <span class="n">training_view</span><span class="p">,</span> <span class="s2">&quot;pks&quot;</span><span class="p">:</span> <span class="n">return_pk_cols</span><span class="p">,</span> <span class="s2">&quot;ts&quot;</span><span class="p">:</span> <span class="n">return_ts_col</span><span class="p">,</span>
                                 <span class="s1">&#39;save_as&#39;</span><span class="p">:</span> <span class="n">save_as</span><span class="p">,</span> <span class="s1">&#39;return_type&#39;</span><span class="p">:</span> <span class="n">ReturnType</span><span class="o">.</span><span class="n">map_to_request</span><span class="p">(</span><span class="n">return_type</span><span class="p">)</span> <span class="p">},</span>
                         <span class="n">body</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="n">features</span><span class="p">,</span> <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="n">start_time</span><span class="p">,</span> <span class="s2">&quot;end_time&quot;</span><span class="p">:</span> <span class="n">end_time</span> <span class="p">},</span>
                         <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Accept-Encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;gzip&quot;</span><span class="p">})</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;sql&quot;</span><span class="p">]</span>
        <span class="n">tvw</span> <span class="o">=</span> <span class="n">TrainingView</span><span class="p">(</span><span class="o">**</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;training_view&quot;</span><span class="p">])</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="o">**</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]]</span>
        <span class="n">create_time</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">][</span><span class="s1">&#39;training_set_create_ts&#39;</span><span class="p">]</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">][</span><span class="s1">&#39;training_set_start_ts&#39;</span><span class="p">]</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">][</span><span class="s1">&#39;training_set_end_ts&#39;</span><span class="p">]</span>
        <span class="c1"># Link this to mlflow for reproducibility and model deployment</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlflow_ctx</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">return_sql</span><span class="p">:</span>
            <span class="c1"># These will only exist if the user called &quot;save_as&quot; otherwise they will be None</span>
            <span class="n">training_set_id</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;training_set_id&#39;</span><span class="p">)</span>
            <span class="n">training_set_version</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;training_set_version&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">link_training_set_to_mlflow</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">create_time</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">tvw</span><span class="p">,</span>
                                             <span class="n">training_set_id</span><span class="o">=</span><span class="n">training_set_id</span><span class="p">,</span>
                                             <span class="n">training_set_version</span><span class="o">=</span><span class="n">training_set_version</span><span class="p">,</span> <span class="n">training_set_name</span><span class="o">=</span><span class="n">save_as</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_format_training_set_output</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="n">return_type</span><span class="p">,</span> <span class="n">splice_ctx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">splice_ctx</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureStore.list_training_sets"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.list_training_sets">[docs]</a>    <span class="k">def</span> <span class="nf">list_training_sets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dictionary a training sets available, with the map name -&gt; description. If there is no description,</span>
<span class="sd">        the value will be an emtpy string</span>

<span class="sd">        :return: Dict[str, Optional[str]]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;To see available training views, run fs.describe_training_views()&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="FeatureStore.create_feature_set"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.create_feature_set">[docs]</a>    <span class="k">def</span> <span class="nf">create_feature_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">primary_keys</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
                           <span class="n">desc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Feature</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FeatureSet</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates and returns a new feature set</span>

<span class="sd">        :param schema_name: The schema under which to create the feature set table</span>
<span class="sd">        :param table_name: The table name for this feature set</span>
<span class="sd">        :param primary_keys: The primary key column(s) of this feature set</span>
<span class="sd">        :param desc: The (optional) description</span>
<span class="sd">        :param features: An optional list of features. If provided, the Features will be created with the Feature Set</span>
<span class="sd">        :Example:</span>
<span class="sd">            .. code-block:: python</span>

<span class="sd">                from splicemachine.features import FeatureType, Feature</span>
<span class="sd">                f1 = Feature(</span>
<span class="sd">                    name=&#39;my_first_feature&#39;,</span>
<span class="sd">                    description=&#39;the first feature&#39;,</span>
<span class="sd">                    feature_data_type=&#39;INT&#39;,</span>
<span class="sd">                    feature_type=FeatureType.ordinal,</span>
<span class="sd">                    tags=[&#39;good_feature&#39;,&#39;a new tag&#39;, &#39;ordinal&#39;],</span>
<span class="sd">                    attributes={&#39;quality&#39;:&#39;awesome&#39;}</span>
<span class="sd">                )</span>
<span class="sd">                f2 = Feature(</span>
<span class="sd">                    name=&#39;my_second_feature&#39;,</span>
<span class="sd">                    description=&#39;the second feature&#39;,</span>
<span class="sd">                    feature_data_type=&#39;FLOAT&#39;,</span>
<span class="sd">                    feature_type=FeatureType.continuous,</span>
<span class="sd">                    tags=[&#39;not_as_good_feature&#39;,&#39;a new tag&#39;],</span>
<span class="sd">                    attributes={&#39;quality&#39;:&#39;not as awesome&#39;}</span>
<span class="sd">                )</span>
<span class="sd">                feats = [f1, f2]</span>
<span class="sd">                feature_set = fs.create_feature_set(</span>
<span class="sd">                    schema_name=&#39;splice&#39;,</span>
<span class="sd">                    table_name=&#39;foo&#39;,</span>
<span class="sd">                    primary_keys={&#39;MOMENT_KEY&#39;:&quot;INT&quot;},</span>
<span class="sd">                    desc=&#39;test fset&#39;,</span>
<span class="sd">                    features=feats</span>
<span class="sd">                )</span>

<span class="sd">        :return: FeatureSet</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># database stores object names in upper case</span>
        <span class="n">schema_name</span> <span class="o">=</span> <span class="n">schema_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="n">table_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="vm">__dict__</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span><span class="p">]</span> <span class="k">if</span> <span class="n">features</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">fset_dict</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;schema_name&quot;</span><span class="p">:</span> <span class="n">schema_name</span><span class="p">,</span>
                      <span class="s2">&quot;table_name&quot;</span><span class="p">:</span> <span class="n">table_name</span><span class="p">,</span>
                      <span class="s2">&quot;primary_keys&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">pk</span><span class="p">:</span> <span class="n">sql_to_datatype</span><span class="p">(</span><span class="n">primary_keys</span><span class="p">[</span><span class="n">pk</span><span class="p">])</span> <span class="k">for</span> <span class="n">pk</span> <span class="ow">in</span> <span class="n">primary_keys</span><span class="p">},</span>
                      <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">desc</span><span class="p">,</span>
                      <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="n">features</span><span class="p">}</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Registering feature set </span><span class="si">{</span><span class="n">schema_name</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s1"> in Feature Store&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">features</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Registering </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span><span class="si">}</span><span class="s1"> features for </span><span class="si">{</span><span class="n">schema_name</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s1"> in the Feature Store&#39;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">FEATURE_SETS</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">fset_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FeatureSet</span><span class="p">(</span><span class="o">**</span><span class="n">r</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureStore.update_feature_metadata"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.update_feature_metadata">[docs]</a>    <span class="k">def</span> <span class="nf">update_feature_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">desc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                <span class="n">attributes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the metadata of a feature</span>

<span class="sd">        :param name: The feature name</span>
<span class="sd">        :param desc: The (optional) feature description (default None)</span>
<span class="sd">        :param tags: (optional) List of (str) tag words (default None)</span>
<span class="sd">        :param attributes: (optional) Dict of (str) attribute key/value pairs (default None)</span>
<span class="sd">        :return: updated Feature</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">f_dict</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">desc</span><span class="p">,</span> <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="n">tags</span><span class="p">,</span> <span class="s2">&quot;attributes&quot;</span><span class="p">:</span> <span class="n">attributes</span> <span class="p">}</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Registering feature </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> in Feature Store&#39;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">FEATURES</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">PUT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span>
                         <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">},</span> <span class="n">body</span><span class="o">=</span><span class="n">f_dict</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">Feature</span><span class="p">(</span><span class="o">**</span><span class="n">r</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span></div>

<div class="viewcode-block" id="FeatureStore.create_feature"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.create_feature">[docs]</a>    <span class="k">def</span> <span class="nf">create_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">feature_data_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                       <span class="n">feature_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">attributes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a feature to a feature set</span>

<span class="sd">        :param schema_name: The feature set schema</span>
<span class="sd">        :param table_name: The feature set table name to add the feature to</span>
<span class="sd">        :param name: The feature name</span>
<span class="sd">        :param feature_data_type: The datatype of the feature. Must be a valid SQL datatype</span>
<span class="sd">        :param feature_type: splicemachine.features.FeatureType of the feature. The available types are from the FeatureType class: FeatureType.[categorical, ordinal, continuous].</span>
<span class="sd">            You can see available feature types by running</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                    from splicemachine.features import FeatureType</span>
<span class="sd">                    print(FeatureType.get_valid())</span>

<span class="sd">        :param desc: The (optional) feature description (default None)</span>
<span class="sd">        :param tags: (optional) List of (str) tag words (default None)</span>
<span class="sd">        :param attributes: (optional) Dict of (str) attribute key/value pairs (default None)</span>
<span class="sd">        :return: Feature created</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># database stores object names in upper case</span>
        <span class="n">schema_name</span> <span class="o">=</span> <span class="n">schema_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="n">table_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="k">assert</span> <span class="n">feature_type</span> <span class="ow">in</span> <span class="n">FeatureType</span><span class="o">.</span><span class="n">get_valid</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;The feature_type </span><span class="si">{</span><span class="n">feature_type</span><span class="si">}</span><span class="s2"> in not valid. Valid feature &quot;</span> \
                                                        <span class="sa">f</span><span class="s2">&quot;types include </span><span class="si">{</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">get_valid</span><span class="p">()</span><span class="si">}</span><span class="s2">. Use the FeatureType&quot;</span> \
                                                        <span class="sa">f</span><span class="s2">&quot; class provided by splicemachine.features&quot;</span>

        <span class="n">f_dict</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">desc</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s2">&quot;feature_data_type&quot;</span><span class="p">:</span> <span class="n">sql_to_datatype</span><span class="p">(</span><span class="n">feature_data_type</span><span class="p">),</span>
                    <span class="s2">&quot;feature_type&quot;</span><span class="p">:</span> <span class="n">feature_type</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="n">tags</span><span class="p">,</span> <span class="s2">&quot;attributes&quot;</span><span class="p">:</span> <span class="n">attributes</span> <span class="p">}</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Registering feature </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> in Feature Store&#39;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">FEATURES</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> 
            <span class="p">{</span> <span class="s2">&quot;schema&quot;</span><span class="p">:</span> <span class="n">schema_name</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">table_name</span> <span class="p">},</span> <span class="n">f_dict</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">Feature</span><span class="p">(</span><span class="o">**</span><span class="n">r</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span></div>
        <span class="c1"># TODO: Backfill the feature</span>

<div class="viewcode-block" id="FeatureStore.create_training_view"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.create_training_view">[docs]</a>    <span class="k">def</span> <span class="nf">create_training_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sql</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">primary_keys</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">join_keys</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                             <span class="n">ts_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">label_col</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">replace</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                             <span class="n">desc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Registers a training view for use in generating training SQL</span>

<span class="sd">        :param name: The training set name. This must be unique to other existing training sets unless replace is True</span>
<span class="sd">        :param sql: (str) a SELECT statement that includes:\n</span>
<span class="sd">            * the primary key column(s) - uniquely identifying a training row/case</span>
<span class="sd">            * the inference timestamp column - timestamp column with which to join features (temporal join timestamp)</span>
<span class="sd">            * join key(s) - the references to the other feature tables&#39; primary keys (ie customer_id, location_id)</span>
<span class="sd">            * (optionally) the label expression - defining what the training set is trying to predict</span>
<span class="sd">        :param primary_keys: (List[str]) The list of columns from the training SQL that identify the training row</span>
<span class="sd">        :param ts_col: The timestamp column of the training SQL that identifies the inference timestamp</span>
<span class="sd">        :param label_col: (Optional[str]) The optional label column from the training SQL.</span>
<span class="sd">        :param replace: (Optional[bool]) Whether to replace an existing training view</span>
<span class="sd">        :param join_keys: (List[str]) A list of join keys in the sql that are used to get the desired features in</span>
<span class="sd">            get_training_set</span>
<span class="sd">        :param desc: (Optional[str]) An optional description of the training set</span>
<span class="sd">        :param verbose: Whether or not to print the SQL before execution (default False)</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="s2">&quot;Name of training view cannot be None!&quot;</span>

        <span class="n">tv_dict</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">desc</span><span class="p">,</span> <span class="s2">&quot;pk_columns&quot;</span><span class="p">:</span> <span class="n">primary_keys</span><span class="p">,</span> <span class="s2">&quot;ts_column&quot;</span><span class="p">:</span> <span class="n">ts_col</span><span class="p">,</span> <span class="s2">&quot;label_column&quot;</span><span class="p">:</span> <span class="n">label_col</span><span class="p">,</span>
                    <span class="s2">&quot;join_columns&quot;</span><span class="p">:</span> <span class="n">join_keys</span><span class="p">,</span> <span class="s2">&quot;sql_text&quot;</span><span class="p">:</span> <span class="n">sql</span><span class="p">}</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Registering Training View </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> in the Feature Store&#39;</span><span class="p">)</span>
        <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">TRAINING_VIEWS</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">tv_dict</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_process_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Feature</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Feature</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process a list of Features parameter. If the list is strings, it converts them to Features, else returns itself</span>

<span class="sd">        :param features: The list of Feature names or Feature objects</span>
<span class="sd">        :return: List[Feature]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">feat_str</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">str</span><span class="p">)]</span>
        <span class="n">str_to_feat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_features_by_name</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="n">feat_str</span><span class="p">,</span> <span class="n">as_list</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">feat_str</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="n">all_features</span> <span class="o">=</span> <span class="n">str_to_feat</span> <span class="o">+</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">str</span><span class="p">)]</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">[</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Feature</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_features</span><span class="p">]),</span> <span class="s2">&quot;It seems you&#39;ve passed in Features that are neither&quot;</span> \
                                                             <span class="s2">&quot; a feature name (string) or a Feature object&quot;</span>
        <span class="k">return</span> <span class="n">all_features</span>

<div class="viewcode-block" id="FeatureStore.deploy_feature_set"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.deploy_feature_set">[docs]</a>    <span class="k">def</span> <span class="nf">deploy_feature_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deploys a feature set to the database. This persists the feature stores existence.</span>
<span class="sd">        As of now, once deployed you cannot delete the feature set or add/delete features.</span>
<span class="sd">        The feature set must have already been created with :py:meth:`~features.FeatureStore.create_feature_set`</span>

<span class="sd">        :param schema_name: The schema of the created feature set</span>
<span class="sd">        :param table_name: The table of the created feature set</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># database stores object names in upper case</span>
        <span class="n">schema_name</span> <span class="o">=</span> <span class="n">schema_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="n">table_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Deploying Feature Set </span><span class="si">{</span><span class="n">schema_name</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">DEPLOY_FEATURE_SET</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> <span class="p">{</span> <span class="s2">&quot;schema&quot;</span><span class="p">:</span> <span class="n">schema_name</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">table_name</span> <span class="p">})</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureStore.get_features_from_feature_set"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.get_features_from_feature_set">[docs]</a>    <span class="k">def</span> <span class="nf">get_features_from_feature_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Feature</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns either a pandas DF of feature details or a List of features for a specified feature set.</span>
<span class="sd">        You can get features from multiple feature sets by concatenating the results of this call.</span>
<span class="sd">        For example, to get features from 2 feature sets, `foo.bar1` and `foo2.bar4`:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">                features = fs.get_features_from_feature_set(&#39;foo&#39;,&#39;bar1&#39;) + fs.get_features_from_feature_set(&#39;foo2&#39;,&#39;bar4&#39;)</span>

<span class="sd">        :param schema_name: Feature Set schema name</span>
<span class="sd">        :param table_name: Feature Set table name</span>
<span class="sd">        :return: List of Features</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">FEATURE_SET_DETAILS</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span>
                         <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;schema&#39;</span><span class="p">:</span><span class="n">schema_name</span><span class="p">,</span> <span class="s1">&#39;table&#39;</span><span class="p">:</span><span class="n">table_name</span><span class="p">})</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="o">**</span><span class="n">feature</span><span class="p">)</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">features</span></div>

<div class="viewcode-block" id="FeatureStore.describe_feature_sets"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.describe_feature_sets">[docs]</a>    <span class="k">def</span> <span class="nf">describe_feature_sets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints out a description of a all feature sets, with all features in the feature sets and whether the feature</span>
<span class="sd">        set is deployed</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">FEATURE_SET_DETAILS</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Available feature sets&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">r</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="k">else</span> <span class="p">[</span><span class="n">r</span><span class="p">]:</span>
            <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="o">**</span><span class="n">feature</span><span class="p">)</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">desc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;features&#39;</span><span class="p">)]</span>
            <span class="n">fset</span> <span class="o">=</span> <span class="n">FeatureSet</span><span class="p">(</span><span class="o">**</span><span class="n">desc</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">23</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_feature_set_describe</span><span class="p">(</span><span class="n">fset</span><span class="p">,</span> <span class="n">features</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureStore.describe_feature_set"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.describe_feature_set">[docs]</a>    <span class="k">def</span> <span class="nf">describe_feature_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints out a description of a given feature set, with all features in the feature set and whether the feature</span>
<span class="sd">        set is deployed</span>

<span class="sd">        :param schema_name: feature set schema name</span>
<span class="sd">        :param table_name: feature set table name</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># database stores object names in upper case</span>
        <span class="n">schema_name</span> <span class="o">=</span> <span class="n">schema_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="n">table_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">FEATURE_SET_DETAILS</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span>
                         <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;schema&#39;</span><span class="p">:</span><span class="n">schema_name</span><span class="p">,</span> <span class="s1">&#39;table&#39;</span><span class="p">:</span><span class="n">table_name</span><span class="p">})</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="n">r</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">desc</span><span class="p">:</span> <span class="k">raise</span> <span class="n">SpliceMachineException</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Feature Set </span><span class="si">{</span><span class="n">schema_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> not found. Check name and try again.&quot;</span><span class="p">)</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="o">**</span><span class="n">feature</span><span class="p">)</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">desc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">)]</span>
        <span class="n">fset</span> <span class="o">=</span> <span class="n">FeatureSet</span><span class="p">(</span><span class="o">**</span><span class="n">desc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feature_set_describe</span><span class="p">(</span><span class="n">fset</span><span class="p">,</span> <span class="n">features</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_feature_set_describe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fset</span><span class="p">:</span> <span class="n">FeatureSet</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Feature</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">fset</span><span class="o">.</span><span class="n">schema_name</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">fset</span><span class="o">.</span><span class="n">table_name</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="n">fset</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Primary keys:&#39;</span><span class="p">,</span> <span class="n">fset</span><span class="o">.</span><span class="n">primary_keys</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Available features:&#39;</span><span class="p">)</span>
        <span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="vm">__dict__</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span><span class="p">))</span>

<div class="viewcode-block" id="FeatureStore.describe_training_views"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.describe_training_views">[docs]</a>    <span class="k">def</span> <span class="nf">describe_training_views</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints out a description of all training views, the ID, name, description and optional label</span>

<span class="sd">        :param training_view: The training view name</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">TRAINING_VIEW_DETAILS</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Available training views&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">r</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="k">else</span> <span class="p">[</span><span class="n">r</span><span class="p">]:</span>
            <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="o">**</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">desc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;features&#39;</span><span class="p">)]</span>
            <span class="n">tcx</span> <span class="o">=</span> <span class="n">TrainingView</span><span class="p">(</span><span class="o">**</span><span class="n">desc</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">23</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_training_view_describe</span><span class="p">(</span><span class="n">tcx</span><span class="p">,</span> <span class="n">features</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureStore.describe_training_view"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.describe_training_view">[docs]</a>    <span class="k">def</span> <span class="nf">describe_training_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">training_view</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints out a description of a given training view, the ID, name, description and optional label</span>

<span class="sd">        :param training_view: The training view name</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">TRAINING_VIEW_DETAILS</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">training_view</span><span class="p">})</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="n">r</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">desc</span><span class="p">:</span> <span class="k">raise</span> <span class="n">SpliceMachineException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training view </span><span class="si">{</span><span class="n">training_view</span><span class="si">}</span><span class="s2"> not found. Check name and try again.&quot;</span><span class="p">)</span>

        <span class="n">feats</span> <span class="o">=</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="o">**</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">desc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;features&#39;</span><span class="p">)]</span>
        <span class="n">tcx</span> <span class="o">=</span> <span class="n">TrainingView</span><span class="p">(</span><span class="o">**</span><span class="n">desc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_training_view_describe</span><span class="p">(</span><span class="n">tcx</span><span class="p">,</span> <span class="n">feats</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_training_view_describe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tcx</span><span class="p">:</span> <span class="n">TrainingView</span><span class="p">,</span> <span class="n">feats</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Feature</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ID(</span><span class="si">{</span><span class="n">tcx</span><span class="o">.</span><span class="n">view_id</span><span class="si">}</span><span class="s1">) </span><span class="si">{</span><span class="n">tcx</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="n">tcx</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s1"> - LABEL: </span><span class="si">{</span><span class="n">tcx</span><span class="o">.</span><span class="n">label_column</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Available features in </span><span class="si">{</span><span class="n">tcx</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">:&#39;</span><span class="p">)</span>

        <span class="n">col_order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_data_type&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_set_name&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_type&#39;</span><span class="p">,</span> <span class="s1">&#39;tags&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;last_update_ts&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;last_update_username&#39;</span><span class="p">,</span> <span class="s1">&#39;compliance_level&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_set_id&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_id&#39;</span><span class="p">]</span>
        <span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="vm">__dict__</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">feats</span><span class="p">)[</span><span class="n">col_order</span><span class="p">])</span>

<div class="viewcode-block" id="FeatureStore.set_feature_description"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.set_feature_description">[docs]</a>    <span class="k">def</span> <span class="nf">set_feature_description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="FeatureStore.get_training_set_from_deployment"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.get_training_set_from_deployment">[docs]</a>    <span class="k">def</span> <span class="nf">get_training_set_from_deployment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                         <span class="n">return_pk_cols</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">return_ts_col</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                         <span class="n">return_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;spark&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads Feature Store metadata to rebuild orginal training data set used for the given deployed model.</span>

<span class="sd">        :param schema_name: model schema name</span>
<span class="sd">        :param table_name: model table name</span>
<span class="sd">        :param label: An optional label to specify for the training set. If specified, the feature set of that feature</span>
<span class="sd">            will be used as the &quot;anchor&quot; feature set, meaning all point in time joins will be made to the timestamps of</span>
<span class="sd">            that feature set. This feature will also be recorded as a &quot;label&quot; feature for this particular training set</span>
<span class="sd">            (but not others in the future, unless this label is again specified).</span>
<span class="sd">        :param return_pk_cols: bool Whether or not the returned sql should include the primary key column(s)</span>
<span class="sd">        :param return_ts_cols: bool Whether or not the returned sql should include the timestamp column</span>
<span class="sd">        :param return_type: How the data should be returned. If not specified, a Spark DF will be returned.</span>
<span class="sd">            Available arguments are: &#39;spark&#39;, &#39;pandas&#39;, &#39;json&#39;, &#39;sql&#39;</span>
<span class="sd">            sql will return the SQL necessary to generate the dataframe</span>
<span class="sd">        :return: SparkDF the Training Frame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># database stores object names in upper case</span>
        <span class="n">schema_name</span> <span class="o">=</span> <span class="n">schema_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="n">table_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>


        <span class="k">if</span> <span class="n">return_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ReturnType</span><span class="o">.</span><span class="n">get_valid</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">SpliceMachineException</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Return type must be one of </span><span class="si">{</span><span class="n">ReturnType</span><span class="o">.</span><span class="n">get_valid</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">TRAINING_SET_FROM_DEPLOYMENT</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> 
            <span class="p">{</span> <span class="s2">&quot;schema&quot;</span><span class="p">:</span> <span class="n">schema_name</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">table_name</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">label</span><span class="p">,</span>
              <span class="s2">&quot;pks&quot;</span><span class="p">:</span> <span class="n">return_pk_cols</span><span class="p">,</span> <span class="s2">&quot;ts&quot;</span><span class="p">:</span> <span class="n">return_ts_col</span><span class="p">,</span> <span class="s1">&#39;return_type&#39;</span><span class="p">:</span> <span class="n">ReturnType</span><span class="o">.</span><span class="n">map_to_request</span><span class="p">(</span><span class="n">return_type</span><span class="p">)})</span>
        
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;metadata&#39;</span><span class="p">]</span>

        <span class="n">tv_name</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;training_set_start_ts&#39;</span><span class="p">]</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;training_set_end_ts&#39;</span><span class="p">]</span>
        <span class="n">create_time</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;training_set_create_ts&#39;</span><span class="p">]</span>

        <span class="n">tv</span> <span class="o">=</span> <span class="n">TrainingView</span><span class="p">(</span><span class="o">**</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;training_view&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;training_view&#39;</span> <span class="ow">in</span> <span class="n">r</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="o">**</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">]]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlflow_ctx</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">link_training_set_to_mlflow</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">create_time</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">,</span> <span class="n">tv</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_format_training_set_output</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="n">return_type</span><span class="p">,</span> <span class="n">splice_ctx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">splice_ctx</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureStore.remove_feature"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.remove_feature">[docs]</a>    <span class="k">def</span> <span class="nf">remove_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a feature. This will run 2 checks.</span>
<span class="sd">            1. See if the feature exists.</span>
<span class="sd">            2. See if the feature belongs to a feature set that has already been deployed.</span>

<span class="sd">            If either of these are true, this function will throw an error explaining which check has failed</span>

<span class="sd">            :param name: feature name</span>
<span class="sd">            :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing feature </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">FEATURES</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">DELETE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> <span class="p">{</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span> <span class="p">})</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureStore.get_deployments"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.get_deployments">[docs]</a>    <span class="k">def</span> <span class="nf">get_deployments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">training_set</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">feature</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">feature_set</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of all (or specified) available deployments</span>

<span class="sd">        :param schema_name: model schema name</span>
<span class="sd">        :param table_name: model table name</span>
<span class="sd">        :param training_set: training set name</span>
<span class="sd">        :param feature: passing this in will return all deployments that used this feature</span>
<span class="sd">        :param feature_set: passing this in will return all deployments that used this feature set</span>
<span class="sd">        :return: List[Deployment] the list of Deployments as dicts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">DEPLOYMENTS</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> 
            <span class="p">{</span> <span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="n">schema_name</span><span class="p">,</span> <span class="s1">&#39;table&#39;</span><span class="p">:</span> <span class="n">table_name</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">training_set</span><span class="p">,</span> <span class="s1">&#39;feat&#39;</span><span class="p">:</span> <span class="n">feature</span><span class="p">,</span> <span class="s1">&#39;fset&#39;</span><span class="p">:</span> <span class="n">feature_set</span><span class="p">})</span></div>
      
<div class="viewcode-block" id="FeatureStore.get_training_set_features"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.get_training_set_features">[docs]</a>    <span class="k">def</span> <span class="nf">get_training_set_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">training_set</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of all features from an available Training Set, as well as details about that Training Set</span>

<span class="sd">        :param training_set: training set name</span>
<span class="sd">        :return: TrainingSet as dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">TRAINING_SET_FEATURES</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> 
            <span class="p">{</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">training_set</span> <span class="p">})</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Feature</span><span class="p">(</span><span class="o">**</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">r</span></div>

<div class="viewcode-block" id="FeatureStore.remove_feature_set"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.remove_feature_set">[docs]</a>    <span class="k">def</span> <span class="nf">remove_feature_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">purge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes a feature set if appropriate. You can currently delete a feature set in two scenarios:</span>
<span class="sd">        1. The feature set has not been deployed</span>
<span class="sd">        2. The feature set has been deployed, but not linked to any training sets</span>

<span class="sd">        If both of these conditions are false, this will fail.</span>

<span class="sd">        Optionally set purge=True to force delete the feature set and all of the associated Training Sets using the</span>
<span class="sd">        Feature Set. ONLY USE IF YOU KNOW WHAT YOU ARE DOING. This will delete Training Sets, but will still fail if</span>
<span class="sd">        there is an active deployment with this feature set. That cannot be overwritten</span>

<span class="sd">        :param schema_name: The Feature Set Schema</span>
<span class="sd">        :param table_name: The Feature Set Table</span>
<span class="sd">        :param purge: Whether to force delete training sets that use the feature set (that are not used in deployments)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">purge</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;You&#39;ve set purge=True, I hope you know what you are doing! This will delete any dependent&quot;</span>
                          <span class="s2">&quot; Training Sets (except ones used in an active model deployment)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Removing Feature Set </span><span class="si">{</span><span class="n">schema_name</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">FEATURE_SETS</span><span class="p">,</span>
                     <span class="n">RequestType</span><span class="o">.</span><span class="n">DELETE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> <span class="p">{</span> <span class="s2">&quot;schema&quot;</span><span class="p">:</span> <span class="n">schema_name</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">:</span><span class="n">table_name</span><span class="p">,</span> <span class="s2">&quot;purge&quot;</span><span class="p">:</span> <span class="n">purge</span> <span class="p">})</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureStore.create_source"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.create_source">[docs]</a>    <span class="k">def</span> <span class="nf">create_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sql</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">event_ts_column</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
                      <span class="n">update_ts_column</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">primary_keys</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates, validates, and stores a source in the Feature Store that can be used to create a Pipeline that</span>
<span class="sd">        feeds a feature set</span>

<span class="sd">        :Example:</span>
<span class="sd">            .. code-block:: python</span>

<span class="sd">                fs.create_source(</span>
<span class="sd">                    name=&#39;CUSTOMER_RFM&#39;,</span>
<span class="sd">                    sql=&#39;SELECT * FROM RETAIL_RFM.CUSTOMER_CATEGORY_ACTIVITY&#39;,</span>
<span class="sd">                    event_ts_column=&#39;INVOICEDATE&#39;,</span>
<span class="sd">                    update_ts_column=&#39;LAST_UPDATE_TS&#39;,</span>
<span class="sd">                    primary_keys=[&#39;CUSTOMERID&#39;]</span>
<span class="sd">                )</span>

<span class="sd">        :param name: The name of the source. This must be unique across the feature store</span>
<span class="sd">        :param sql: the SQL statement that returns the base result set to be used in future aggregation pipelines</span>
<span class="sd">        :param event_ts_column: The column of the source query that determines the time of the event (row) being</span>
<span class="sd">        described. This is not necessarily the time the record was recorded, but the time the event itself occured.</span>

<span class="sd">        :param update_ts_column: The column that indicates the time when the record was last updated. When scheduled</span>
<span class="sd">        pipelines run, they will filter on this column to get only the records that have not been queried before.</span>

<span class="sd">        :param primary_keys: The list of columns in the source SQL that uniquely identifies each row. These become</span>
<span class="sd">        the primary keys of the feature set(s) that is/are eventually created from this source.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">source</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
            <span class="s1">&#39;sql_text&#39;</span><span class="p">:</span> <span class="n">sql</span><span class="p">,</span>
            <span class="s1">&#39;event_ts_column&#39;</span><span class="p">:</span> <span class="n">event_ts_column</span><span class="p">,</span>
            <span class="s1">&#39;update_ts_column&#39;</span><span class="p">:</span> <span class="n">update_ts_column</span><span class="p">,</span>
            <span class="s1">&#39;pk_columns&#39;</span><span class="p">:</span> <span class="n">primary_keys</span>

        <span class="p">}</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Registering Source </span><span class="si">{</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1"> in the Feature Store&#39;</span><span class="p">)</span>
        <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">SOURCE</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestType</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">source</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureStore.remove_source"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.remove_source">[docs]</a>    <span class="k">def</span> <span class="nf">remove_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a Source by name. You cannot remove a Source that has child dependencies (Feature Sets). If there is a</span>
<span class="sd">        Feature Set that is deployed and a Pipeline that is feeding it, you cannot delete the Source until you remove</span>
<span class="sd">        the Feature Set (which in turn removes the Pipeline)</span>

<span class="sd">        :param name: The Source name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Deleting Source </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">SOURCE</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestType</span><span class="o">.</span><span class="n">DELETE</span><span class="p">,</span>
                     <span class="n">auth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">})</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureStore.create_aggregation_feature_set_from_source"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.create_aggregation_feature_set_from_source">[docs]</a>    <span class="k">def</span> <span class="nf">create_aggregation_feature_set_from_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                                   <span class="n">start_time</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">schedule_interval</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                                   <span class="n">aggregations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FeatureAggregation</span><span class="p">],</span>
                                                   <span class="n">backfill_start_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">backfill_interval</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                                   <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">run_backfill</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                                                   <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a temporal aggregation feature set by creating a pipeline linking a Source to a feature set.</span>
<span class="sd">        Sources are created with :py:meth:`features.FeatureStore.create_source`.</span>
<span class="sd">        Provided aggregations will generate the features for the feature set. This will create the feature set</span>
<span class="sd">        along with aggregation calculations to create features</span>

<span class="sd">        :param source_name: The name of the of the source created via create_source</span>
<span class="sd">        :param schema_name: The schema name of the feature set</span>
<span class="sd">        :param table_name: The table name of the feature set</span>
<span class="sd">        :param start_time: The start time for the pipeline to run</span>
<span class="sd">        :param schedule_interval: The frequency with which to run the pipeline.</span>
<span class="sd">        :param aggregations: The list of FeatureAggregations to apply to the column names of the source SQL statement</span>
<span class="sd">        :param backfill_start_time: The datetime representing the earliest point in time to get data from when running</span>
<span class="sd">            backfill</span>
<span class="sd">        :param backfill_interval: The &quot;sliding window&quot; interval to increase each timepoint by when performing backfill</span>
<span class="sd">        :param run_backfill: Whether or not to run backfill when calling this function. Default False. If this is True</span>
<span class="sd">            backfill_start_time and backfill_interval MUST BE SET</span>
<span class="sd">        :return: (FeatureSet) the created Feature Set</span>

<span class="sd">        :Example:</span>
<span class="sd">            .. code-block:: python</span>

<span class="sd">                from splicemachine.features.pipelines import AggWindow, FeatureAgg, FeatureAggregation</span>
<span class="sd">                from datetime import datetime</span>
<span class="sd">                source_name = &#39;CUSTOMER_RFM&#39;</span>
<span class="sd">                fs.create_source(</span>
<span class="sd">                    name=source_name,</span>
<span class="sd">                    sql=&#39;SELECT * FROM RETAIL_RFM.CUSTOMER_CATEGORY_ACTIVITY&#39;,</span>
<span class="sd">                    event_ts_column=&#39;INVOICEDATE&#39;,</span>
<span class="sd">                    update_ts_column=&#39;LAST_UPDATE_TS&#39;,</span>
<span class="sd">                    primary_keys=[&#39;CUSTOMERID&#39;]</span>
<span class="sd">                )</span>
<span class="sd">                fs.create_aggregation_feature_set_from_source(</span>

<span class="sd">                )</span>
<span class="sd">                start_time = datetime.today()</span>
<span class="sd">                schedule_interval = AggWindow.get_window(5,AggWindow.DAY)</span>
<span class="sd">                backfill_start = datetime.strptime(&#39;2002-01-01 00:00:00&#39;, &#39;%Y-%m-%d %H:%M:%S&#39;)</span>
<span class="sd">                backfill_interval = schedule_interval</span>
<span class="sd">                fs.create_aggregation_feature_set_from_source</span>
<span class="sd">                (</span>
<span class="sd">                    source_name, &#39;RETAIL_FS&#39;, &#39;AUTO_RFM&#39;, start_time=start_time,</span>
<span class="sd">                    schedule_interval=schedule_interval, backfill_start_time=backfill_start,</span>
<span class="sd">                    backfill_interval=backfill_interval,</span>
<span class="sd">                    aggregations = [</span>
<span class="sd">                        FeatureAggregation(feature_name_prefix = &#39;AR_CLOTHING_QTY&#39;,     column_name = &#39;CLOTHING_QTY&#39;,     agg_functions=[&#39;sum&#39;,&#39;max&#39;],   agg_windows=[&#39;1d&#39;,&#39;2d&#39;,&#39;90d&#39;], agg_default_value = 0.0 ),</span>
<span class="sd">                        FeatureAggregation(feature_name_prefix = &#39;AR_DELICATESSEN_QTY&#39;, column_name = &#39;DELICATESSEN_QTY&#39;, agg_functions=[&#39;avg&#39;],         agg_windows=[&#39;1d&#39;,&#39;2d&#39;, &#39;2w&#39;], agg_default_value = 11.5 ),</span>
<span class="sd">                        FeatureAggregation(feature_name_prefix = &#39;AR_GARDEN_QTY&#39; ,      column_name = &#39;GARDEN_QTY&#39;,       agg_functions=[&#39;count&#39;,&#39;avg&#39;], agg_windows=[&#39;30d&#39;,&#39;90d&#39;, &#39;1q&#39;], agg_default_value = 8 )</span>
<span class="sd">                    ]</span>
<span class="sd">                )</span>

<span class="sd">            This will create, deploy and return a FeatureSet called &#39;RETAIL_FS.AUTO_RFM&#39;.</span>
<span class="sd">            The Feature Set will have 15 features:\n</span>
<span class="sd">            * 6 for the `AR_CLOTHING_QTY` prefix (sum &amp; max over provided agg windows)</span>
<span class="sd">            * 3 for the `AR_DELICATESSEN_QTY` prefix (avg over provided agg windows)</span>
<span class="sd">            * 6 for the `AR_GARDEN_QTY` prefix (count &amp; avg over provided agg windows)</span>

<span class="sd">            A Pipeline is also created and scheduled in Airflow that feeds it every 5 days from the Source `CUSTOMER_RFM`</span>
<span class="sd">            Backfill will also occur, reading data from the source as of &#39;2002-01-01 00:00:00&#39; with a 5 day window</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">schema_name</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">source_name</span> <span class="o">=</span> <span class="n">schema_name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">table_name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">source_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">agg_feature_set</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;source_name&#39;</span><span class="p">:</span> <span class="n">source_name</span><span class="p">,</span>
            <span class="s1">&#39;schema_name&#39;</span><span class="p">:</span> <span class="n">schema_name</span><span class="p">,</span>
            <span class="s1">&#39;table_name&#39;</span><span class="p">:</span> <span class="n">table_name</span><span class="p">,</span>
            <span class="s1">&#39;start_time&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">start_time</span><span class="p">),</span>
            <span class="s1">&#39;schedule_interval&#39;</span><span class="p">:</span> <span class="n">schedule_interval</span><span class="p">,</span>
            <span class="s1">&#39;aggregations&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="vm">__dict__</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">aggregations</span><span class="p">],</span>
            <span class="s1">&#39;backfill_start_time&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">backfill_start_time</span><span class="p">),</span>
            <span class="s1">&#39;backfill_interval&#39;</span><span class="p">:</span> <span class="n">backfill_interval</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">description</span>
        <span class="p">}</span>
        <span class="n">num_features</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">agg_functions</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">agg_windows</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">aggregations</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Registering aggregation feature set </span><span class="si">{</span><span class="n">schema_name</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">num_features</span><span class="si">}</span><span class="s1"> features&#39;</span>
              <span class="sa">f</span><span class="s1">&#39; in the Feature Store...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">AGG_FEATURE_SET_FROM_SOURCE</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span>
                     <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;run_backfill&#39;</span><span class="p">:</span> <span class="n">run_backfill</span><span class="p">},</span> <span class="n">body</span><span class="o">=</span><span class="n">agg_feature_set</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FeatureSet</span><span class="p">(</span><span class="o">**</span><span class="n">r</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureStore.get_backfill_sql"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.get_backfill_sql">[docs]</a>    <span class="k">def</span> <span class="nf">get_backfill_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the necessary parameterized SQL statement to perform backfill on an Aggregate Feature Set. The Feature</span>
<span class="sd">        Set must have been deployed using the :py:meth:`features.FeatureStore.create_aggregation_feature_set_from_source`</span>
<span class="sd">        function. Meaning there must be a Source and a Pipeline associated to it. This function will likely not be</span>
<span class="sd">        necessary as you can perform backfill at the time of feature set creation automatically.</span>

<span class="sd">        This SQL will be parameterized and need a timestamp to execute. You can get those timestamps with the</span>
<span class="sd">        :py:meth:`features.FeatureStore.get_backfill_interval` with the same parameters</span>

<span class="sd">        :param schema_name: The schema name of the feature set</span>
<span class="sd">        :param table_name: The table name of the feature set</span>
<span class="sd">        :return: The parameterized Backfill SQL</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">p</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="n">schema_name</span><span class="p">,</span>
            <span class="s1">&#39;table&#39;</span><span class="p">:</span> <span class="n">table_name</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">BACKFILL_SQL</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">p</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureStore.get_pipeline_sql"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.get_pipeline_sql">[docs]</a>    <span class="k">def</span> <span class="nf">get_pipeline_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the incremental pipeline SQL that feeds a feature set from a source (thus creating a pipeline).</span>
<span class="sd">        Pipelines are managed for you by default by Splice Machine via Airflow, but if you opt out of using the</span>
<span class="sd">        managed pipelines you can use this function to get the incremental SQL.</span>

<span class="sd">        This SQL will be parameterized and need a timestamp to execute. You can get those timestamps with the</span>
<span class="sd">        :py:meth:`features.FeatureStore.get_backfill_interval` with the same parameters</span>

<span class="sd">        :param schema_name: The schema name of the feature set</span>
<span class="sd">        :param table_name: The table name of the feature set</span>
<span class="sd">        :return: The incremental Pipeline SQL</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">p</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="n">schema_name</span><span class="p">,</span>
            <span class="s1">&#39;table&#39;</span><span class="p">:</span> <span class="n">table_name</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">PIPELINE_SQL</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">p</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureStore.get_backfill_intervals"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.get_backfill_intervals">[docs]</a>    <span class="k">def</span> <span class="nf">get_backfill_intervals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">datetime</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the backfill intervals necessary for the parameterized backfill SQL obtained from the</span>
<span class="sd">        :py:meth:`features.FeatureStore.get_backfill_sql` function. This function will likely not be</span>
<span class="sd">        necessary as you can perform backfill at the time of feature set creation automatically.</span>

<span class="sd">        :param schema_name: The schema name of the feature set</span>
<span class="sd">        :param table_name: The table name of the feature set</span>
<span class="sd">        :return: The list of datetimes necessary to parameterize the backfill SQL</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="n">schema_name</span><span class="p">,</span>
            <span class="s1">&#39;table&#39;</span><span class="p">:</span> <span class="n">table_name</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">BACKFILL_INTERVALS</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">p</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_retrieve_model_data_sets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the training set dataframe and model table dataframe for a given deployed model.</span>

<span class="sd">        :param schema_name: model schema name</span>
<span class="sd">        :param table_name: model table name</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># database stores object names in upper case</span>
        <span class="n">schema_name</span> <span class="o">=</span> <span class="n">schema_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="n">table_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="n">training_set_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_training_set_from_deployment</span><span class="p">(</span><span class="n">schema_name</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
        <span class="n">model_table_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splice_ctx</span><span class="o">.</span><span class="n">df</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;SELECT * FROM </span><span class="si">{</span><span class="n">schema_name</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">training_set_df</span><span class="p">,</span> <span class="n">model_table_df</span>

    <span class="k">def</span> <span class="nf">_retrieve_training_set_metadata_from_deployement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads Feature Store metadata to retrieve definition of training set used to train the specified model.</span>
<span class="sd">        :param schema_name: model schema name</span>
<span class="sd">        :param table_name: model table name</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># database stores object names in upper case</span>
        <span class="n">schema_name</span> <span class="o">=</span> <span class="n">schema_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="n">table_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="n">SQL</span><span class="o">.</span><span class="n">get_deployment_metadata</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">schema_name</span><span class="o">=</span><span class="n">schema_name</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span><span class="p">)</span>
        <span class="n">deploy_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splice_ctx</span><span class="o">.</span><span class="n">df</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">cnt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">deploy_df</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">deploy_df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<div class="viewcode-block" id="FeatureStore.display_model_feature_drift"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.display_model_feature_drift">[docs]</a>    <span class="k">def</span> <span class="nf">display_model_feature_drift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays feature by feature comparison between the training set of the deployed model and the input feature</span>
<span class="sd">        values used with the model since deployment.</span>

<span class="sd">        :param schema_name: name of database schema where model table is deployed</span>
<span class="sd">        :param table_name: name of the model table</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># database stores object names in upper case</span>
        <span class="n">schema_name</span> <span class="o">=</span> <span class="n">schema_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="n">table_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="n">metadata</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span><span class="p">,</span> <span class="n">Endpoints</span><span class="o">.</span><span class="n">TRAINING_SET_FROM_DEPLOYMENT</span><span class="p">,</span> <span class="n">RequestType</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span> <span class="s2">&quot;schema&quot;</span><span class="p">:</span> <span class="n">schema_name</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">table_name</span><span class="p">})[</span><span class="s1">&#39;metadata&#39;</span><span class="p">]</span>

        <span class="n">training_set_df</span><span class="p">,</span> <span class="n">model_table_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retrieve_model_data_sets</span><span class="p">(</span><span class="n">schema_name</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">build_feature_drift_plot</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">training_set_df</span><span class="p">,</span> <span class="n">model_table_df</span><span class="p">)</span></div>


<div class="viewcode-block" id="FeatureStore.display_model_drift"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.display_model_drift">[docs]</a>    <span class="k">def</span> <span class="nf">display_model_drift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">time_intervals</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                            <span class="n">start_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">end_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays as many as `time_intervals` plots showing the distribution of the model prediction within each time</span>
<span class="sd">        period. Time periods are equal periods of time where predictions are present in the model table</span>
<span class="sd">        `schema_name.table_name`. Model predictions are first filtered to only those occurring after `start_time` if</span>
<span class="sd">        specified and before `end_time` if specified.</span>

<span class="sd">        :param schema_name: schema where the model table resides</span>
<span class="sd">        :param table_name: name of the model table</span>
<span class="sd">        :param time_intervals: number of time intervals to plot</span>
<span class="sd">        :param start_time: if specified, filters to only show predictions occurring after this date/time</span>
<span class="sd">        :param end_time: if specified, filters to only show predictions occurring before this date/time</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># database stores object names in upper case</span>
        <span class="n">schema_name</span> <span class="o">=</span> <span class="n">schema_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="n">table_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="c1"># set default timeframe if not specified</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">start_time</span><span class="p">:</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1900</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">end_time</span><span class="p">:</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="c1"># retrieve predictions the model has made over time</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="n">SQL</span><span class="o">.</span><span class="n">get_model_predictions</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">schema_name</span><span class="o">=</span><span class="n">schema_name</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span>
                                               <span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="n">end_time</span><span class="p">)</span>
        <span class="n">model_table_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splice_ctx</span><span class="o">.</span><span class="n">df</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
        <span class="n">build_model_drift_plot</span><span class="p">(</span><span class="n">model_table_df</span><span class="p">,</span> <span class="n">time_intervals</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureStore.display_feature_search"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.display_feature_search">[docs]</a>    <span class="k">def</span> <span class="nf">display_feature_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pandas_profile</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an interactive feature search that enables users to search for features and profiles the selected Feature.</span>
<span class="sd">        Two forms of this search exist. 1 for use inside of the managed Splice Machine notebook environment, and one</span>
<span class="sd">        for standard Jupyter. This is because the managed Splice Jupyter environment has extra functionality that would</span>
<span class="sd">        not be present outside of it. The search will be automatically rendered depending on the environment.</span>

<span class="sd">        :param pandas_profile: Whether to use pandas / spark to profile the feature. If pandas is selected</span>
<span class="sd">        but the dataset is too large, it will fall back to Spark. Default Pandas.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># It may have the attr but be None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;splice_ctx&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splice_ctx</span><span class="p">,</span> <span class="n">PySpliceContext</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">SpliceMachineException</span><span class="p">(</span><span class="s1">&#39;You must register a Splice Machine Context (PySpliceContext) in order to use &#39;</span>
                                         <span class="s1">&#39;this function currently&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_in_splice_compatible_env</span><span class="p">():</span>
            <span class="n">feature_search_internal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pandas_profile</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">feature_search_external</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pandas_profile</span><span class="p">)</span></div>



    <span class="k">def</span> <span class="nf">__get_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">model_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a Pipeline with preprocessing steps (StringINdexer, VectorAssembler) for each feature depending</span>
<span class="sd">        on feature type, and returns the pipeline for training for feature elimination</span>

<span class="sd">        :param df: Spark Dataframe</span>
<span class="sd">        :param features: List[Feature] to train on</span>
<span class="sd">        :param label: Label name to train on</span>
<span class="sd">        :param model_type: (str) the model type - avl options are &quot;classification&quot; and &quot;regression&quot;</span>
<span class="sd">        :return: Unfit Spark Pipeline</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">categorical_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_categorical</span><span class="p">()]</span>
        <span class="n">numeric_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_continuous</span><span class="p">()</span> <span class="ow">or</span> <span class="n">f</span><span class="o">.</span><span class="n">is_ordinal</span><span class="p">()]</span>
        <span class="n">indexed_features</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">_index&#39;</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">categorical_features</span><span class="p">]</span>

        <span class="n">si</span> <span class="o">=</span> <span class="p">[</span><span class="n">StringIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">_index&#39;</span><span class="p">,</span> <span class="n">handleInvalid</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">categorical_features</span><span class="p">]</span>
        <span class="n">all_features</span> <span class="o">=</span> <span class="n">numeric_features</span> <span class="o">+</span> <span class="n">indexed_features</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">VectorAssembler</span><span class="p">(</span><span class="n">inputCols</span><span class="o">=</span><span class="n">all_features</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s1">&#39;features&#39;</span><span class="p">,</span> <span class="n">handleInvalid</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;classification&#39;</span><span class="p">:</span>
            <span class="n">si</span> <span class="o">+=</span> <span class="p">[</span><span class="n">StringIndexer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1">_index&#39;</span><span class="p">,</span> <span class="n">handleInvalid</span><span class="o">=</span><span class="s1">&#39;keep&#39;</span><span class="p">)]</span>
            <span class="n">clf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">labelCol</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1">_index&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">clf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">labelCol</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="n">si</span> <span class="o">+</span> <span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="n">clf</span><span class="p">])</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_feature_importance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_importances</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">features_column</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the ordered feature importance for the feature elimination rounds</span>
<span class="sd">        :param feature_importances: Spark model featureImportances attribute</span>
<span class="sd">        :param df: Spark dataframe</span>
<span class="sd">        :param features_column: Column name of the dataframe that holds the features</span>
<span class="sd">        :return: Sorted pandas dataframe with the feature importances and feature names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">feature_rank</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">schema</span><span class="p">[</span><span class="n">features_column</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;ml_attr&quot;</span><span class="p">][</span><span class="s2">&quot;attrs&quot;</span><span class="p">]:</span>
            <span class="n">feature_rank</span> <span class="o">+=</span> <span class="n">df</span><span class="o">.</span><span class="n">schema</span><span class="p">[</span><span class="n">features_column</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;ml_attr&quot;</span><span class="p">][</span><span class="s2">&quot;attrs&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="n">features_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">feature_rank</span><span class="p">)</span>
        <span class="n">features_df</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">features_df</span><span class="p">[</span><span class="s1">&#39;idx&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">feature_importances</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">features_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__log_mlflow_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">rounds</span><span class="p">,</span> <span class="n">mlflow_results</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Logs the results of feature elimination to mlflow</span>

<span class="sd">        :param name: MLflow run name</span>
<span class="sd">        :param rounds: Number of rounds of feature elimination that were run</span>
<span class="sd">        :param mlflow_results: The params / metrics to log</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlflow_ctx</span><span class="o">.</span><span class="n">active_run</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mlflow_ctx</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rounds</span><span class="p">):</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlflow_ctx</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Round </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">nested</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mlflow_ctx</span><span class="o">.</span><span class="n">log_metrics</span><span class="p">(</span><span class="n">mlflow_results</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mlflow_ctx</span><span class="o">.</span><span class="n">end_run</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">__prune_features_for_elimination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Feature</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes incompatible features from the provided list if they are not compatible with SparkML modeling</span>

<span class="sd">        :param features: List[Feature] the provided list</span>
<span class="sd">        :return: List[Features] the pruned list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">splicemachine.spark.constants</span> <span class="kn">import</span> <span class="n">SQL_MODELING_TYPES</span>
        <span class="n">invalid_features</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">feature_data_type</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SQL_MODELING_TYPES</span><span class="p">}</span>
        <span class="n">valid_features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">features</span><span class="p">)</span> <span class="o">-</span> <span class="n">invalid_features</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">invalid_features</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The following features are invalid for modeling based on their Data Types:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">invalid_features</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">feature_data_type</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">valid_features</span>

<div class="viewcode-block" id="FeatureStore.run_feature_elimination"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.run_feature_elimination">[docs]</a>    <span class="k">def</span> <span class="nf">run_feature_elimination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Feature</span><span class="p">]],</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                                <span class="n">verbose</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">model_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;classification&#39;</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                                <span class="n">log_mlflow</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">mlflow_run_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                <span class="n">return_importances</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs feature elimination using a Spark decision tree on the dataframe passed in. Optionally logs results to mlflow</span>

<span class="sd">        :param df: The dataframe with features and label</span>
<span class="sd">        :param features: The list of feature names (or Feature objects) to run elimination on</span>
<span class="sd">        :param label: the label column names</span>
<span class="sd">        :param n: The number of features desired. Default 10</span>
<span class="sd">        :param verbose: The level of verbosity. 0 indicated no printing. 1 indicates printing remaining features after</span>
<span class="sd">            each round. 2 indicates print features and relative importances after each round. Default 0</span>
<span class="sd">        :param model_type: Whether the model to test with will be a regression or classification model. Default classification</span>
<span class="sd">        :param log_mlflow: Whether or not to log results to mlflow as nested runs. Default false</span>
<span class="sd">        :param mlflow_run_name: The name of the parent run under which all subsequent runs will live. The children run</span>
<span class="sd">            names will be {mlflow_run_name}_{num_features}_features. ie testrun_5_features, testrun_4_features etc</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">train_df</span> <span class="o">=</span> <span class="n">df</span>
        <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_features</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
        <span class="n">remaining_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__prune_features_for_elimination</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
        <span class="n">rnd</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">mlflow_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span>
            <span class="n">remaining_features</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">,</span> \
            <span class="s2">&quot;You&#39;ve set the number of desired features (n) greater than the number of available features&quot;</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">remaining_features</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="n">rnd</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">num_features</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">remaining_features</span><span class="p">)</span> <span class="o">-</span> <span class="n">step</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># Don&#39;t go less than the specified value</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Building </span><span class="si">{</span><span class="n">model_type</span><span class="si">}</span><span class="s1"> model&#39;</span><span class="p">)</span>
            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_pipeline</span><span class="p">(</span><span class="n">train_df</span><span class="p">,</span> <span class="n">remaining_features</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">model_type</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Getting feature importance&#39;</span><span class="p">)</span>
            <span class="n">feature_importances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_feature_importance</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">stages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">featureImportances</span><span class="p">,</span>
                                                                <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train_df</span><span class="p">),</span> <span class="s2">&quot;features&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span>
                <span class="n">num_features</span><span class="p">)</span>
            <span class="n">remaining_features_and_label</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">feature_importances</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">label</span><span class="p">]</span>
            <span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="o">*</span><span class="n">remaining_features_and_label</span><span class="p">)</span>
            <span class="n">remaining_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">remaining_features</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">feature_importances</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">remaining_features</span><span class="p">)</span><span class="si">}</span><span class="s1"> features remaining&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">verbose</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Round </span><span class="si">{</span><span class="n">rnd</span><span class="si">}</span><span class="s1"> complete. Remaining Features:&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">feature_importances</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">. </span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">verbose</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Round </span><span class="si">{</span><span class="n">rnd</span><span class="si">}</span><span class="s1"> complete. Remaining Features:&#39;</span><span class="p">)</span>
                <span class="n">display</span><span class="p">(</span><span class="n">feature_importances</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

            <span class="c1"># Add results to a list for mlflow logging</span>
            <span class="n">round_metrics</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Round&#39;</span><span class="p">:</span> <span class="n">rnd</span><span class="p">,</span> <span class="s1">&#39;Number of features&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">remaining_features</span><span class="p">)}</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">feature_importances</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">round_metrics</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span>
            <span class="n">mlflow_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">round_metrics</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">log_mlflow</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlflow_ctx</span><span class="p">:</span>
            <span class="n">run_name</span> <span class="o">=</span> <span class="n">mlflow_run_name</span> <span class="ow">or</span> <span class="sa">f</span><span class="s1">&#39;feature_elimination_</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__log_mlflow_results</span><span class="p">(</span><span class="n">run_name</span><span class="p">,</span> <span class="n">rnd</span><span class="p">,</span> <span class="n">mlflow_results</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">remaining_features</span><span class="p">,</span> <span class="n">feature_importances</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span>
            <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">return_importances</span> <span class="k">else</span> <span class="n">remaining_features</span></div>

<div class="viewcode-block" id="FeatureStore.link_training_set_to_mlflow"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.link_training_set_to_mlflow">[docs]</a>    <span class="k">def</span> <span class="nf">link_training_set_to_mlflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Feature</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">create_time</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">start_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                                    <span class="n">end_time</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tvw</span><span class="p">:</span> <span class="n">TrainingView</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">current_values_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                    <span class="n">training_set_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">training_set_version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                    <span class="n">training_set_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="c1"># Here we create a null training view and pass it into the training set. We do this because this special kind</span>
        <span class="c1"># of training set isn&#39;t standard. It&#39;s not based on a training view, on primary key columns, a label column,</span>
        <span class="c1"># or a timestamp column . This is simply a joined set of features from different feature sets.</span>
        <span class="c1"># But we still want to track this in mlflow as a user may build and deploy a model based on this. So we pass in</span>
        <span class="c1"># a null training view that can be tracked with a &quot;name&quot; (although the name is None). This is a likely case</span>
        <span class="c1"># for (non time based) clustering use cases.</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">tvw</span><span class="p">:</span>
            <span class="n">tvw</span> <span class="o">=</span> <span class="n">TrainingView</span><span class="p">(</span><span class="n">pk_columns</span><span class="o">=</span><span class="p">[],</span> <span class="n">ts_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label_column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">view_sql</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TrainingSet</span><span class="p">(</span><span class="n">training_view</span><span class="o">=</span><span class="n">tvw</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">create_time</span><span class="o">=</span><span class="n">create_time</span><span class="p">,</span>
                        <span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="n">end_time</span><span class="p">,</span> <span class="n">training_set_id</span><span class="o">=</span><span class="n">training_set_id</span><span class="p">,</span>
                         <span class="n">training_set_version</span><span class="o">=</span><span class="n">training_set_version</span><span class="p">,</span> <span class="n">training_set_name</span><span class="o">=</span><span class="n">training_set_name</span><span class="p">)</span>

        <span class="c1"># If the user isn&#39;t getting historical values, that means there isn&#39;t really a start_time, as the user simply</span>
        <span class="c1"># wants the most up to date values of each feature. So we set start_time to end_time (which is datetime.today)</span>
        <span class="k">if</span> <span class="n">current_values_only</span><span class="p">:</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">end_time</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mlflow_ctx</span><span class="o">.</span><span class="n">_active_training_set</span><span class="p">:</span> <span class="n">TrainingSet</span> <span class="o">=</span> <span class="n">ts</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">_register_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mlflow_ctx</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="FeatureStore.set_feature_store_url"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.set_feature_store_url">[docs]</a>    <span class="k">def</span> <span class="nf">set_feature_store_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the Feature Store URL. You must call this before calling any feature store functions, or set the FS_URL</span>
<span class="sd">        environment variable before creating your Feature Store object</span>

<span class="sd">        :param url: The Feature Store URL</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_FS_URL</span> <span class="o">=</span> <span class="n">url</span></div>

<div class="viewcode-block" id="FeatureStore.login_fs"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.login_fs">[docs]</a>    <span class="k">def</span> <span class="nf">login_fs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to login to the Feature Store using basic auth. These correspond to your Splice Machine database user</span>
<span class="sd">        and password. If you are running outside of the managed Splice Machine Cloud Service, you must call either</span>
<span class="sd">        this or set_token in order to call any functions in the feature store, or by setting the SPLICE_JUPYTER_USER and</span>
<span class="sd">        SPLICE_JUPYTER_PASSWORD environments variable before creating your FeatureStore object.</span>

<span class="sd">        :param username: Username</span>
<span class="sd">        :param password: Password</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span> <span class="o">=</span> <span class="n">HTTPBasicAuth</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeatureStore.set_token"><a class="viewcode-back" href="../../../splicemachine.features.html#splicemachine.features.feature_store.FeatureStore.set_token">[docs]</a>    <span class="k">def</span> <span class="nf">set_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to login to the Feature Store using JWT. This corresponds to your Splice Machine database user&#39;s JWT</span>
<span class="sd">        token. If you are running outside of the managed Splice Machine Cloud Service, you must call either</span>
<span class="sd">        this or login_fs in order to call any functions in the feature store, or by setting the SPLICE_JUPYTER_TOKEN</span>
<span class="sd">        environment variable before creating your FeatureStore object.</span>

<span class="sd">        :param token: JWT Token</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auth</span> <span class="o">=</span> <span class="n">token</span></div>

    <span class="k">def</span> <span class="nf">__try_auto_login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tries to login the user  automatically. This will only work if the user is not</span>
<span class="sd">        using the cloud service.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">_get_token</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">token</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_token</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="n">user</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="n">_get_credentials</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">password</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">login_fs</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span></div>
</pre></div>

              </div>
              
        
        <div class='prev-next-bottom'>
            

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Ben Epstein<br/>
        
            &copy; Copyright 2020, Splice Machine.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>